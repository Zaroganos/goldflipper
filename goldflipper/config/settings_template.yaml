# ==================================================
# Goldflipper Configuration File - TEMPLATE
#     last revised: 2025-12-09
# ==================================================
# This YAML `settings` file contains all configurable settings for the Goldflipper trading system.
# All paths are relative to the project root directory unless specified as absolute.
#
# ===== GETTING STARTED =====
# IMPORTANT SETUP INSTRUCTIONS:
# 1. Save this file as "settings.yaml" in the same directory (the setup tool will do this for you).
# 2. Replace all placeholder values (marked with YOUR_*) with your actual keys and values
# 3. Review all settings and adjust the settings and default values according to your preferences
# 4. Save your `settings.yaml` file when finished, or, press `save` if using the graphical settings tool.
#
# REQUIRED CHANGES:
# - Alpaca API Keys:
#     - You must obtain API keys from Alpaca (https://app.alpaca.markets)
#       and replace the placeholders in the alpaca.accounts section
# - MarketDataApp API Key:
#     - If you plan to use MarketDataApp as a data provider,
#       replace the placeholder in market_data_providers.providers.marketdataapp.api_key
#     - You can find how to obtain an API Key for a free tier plan called "Free Forever" at:
#       (https://www.marketdata.app/docs/account/free-accounts)
#
# CONFIGURATION SECTIONS:
# - Alpaca API Settings: API keys and account configuration for Alpaca trading
# - Strategy Settings: Configure options trading strategies
# - Market Data Settings: Configure market data provider sources and display options
# - Order Settings: Configure order execution parameters
# - File Operations: Configure file paths for state based play management
# - Logging Configuration: Configure logging behavior
# - Market Hours Settings: Configure market hours recognition
#
# For detailed documentation on all settings, please contact the Goldflipper Team for support.
#
# ===== FINE TUNING =====
#
# Display Configuration Instructions:
# To enable/disable columns in the option chain display:
# 1. Under market_data.option_chain_display.default_columns:
#    - Add or remove column names to show/hide basic option data
#    - Available columns: strike, lastPrice, bid, ask, volume, impliedVolatility
#
# 2. Under market_data.option_chain_display.greeks:
#    - Set enabled: true/false to show/hide all Greeks
#    - Under columns: add or remove specific Greeks to display
#    - Available Greeks: delta, gamma, theta, vega, rho
#
# Example:
# market_data:
#   option_chain_display:
#     default_columns:       # Show only these basic columns
#       - strike
#       - lastPrice
#       - bid
#       - ask
#     greeks:
#       enabled: true        # Enable Greeks display
#       columns:             # Show only these Greeks
#         - delta
#         - theta

####################################################################################################
# Alpaca API Settings
####################################################################################################
# IMPORTANT: Replace the placeholder API keys with your own Alpaca API credentials
# Get your API keys from: https://app.alpaca.markets/paper/dashboard/overview
alpaca:
  accounts:
    live:
      enabled: false
      # Set to true only when you are ready to trade live, with real money
      nickname: "Live Trading"
      api_key: 'YOUR_LIVE_API_KEY'           # Replace with your live API key
      secret_key: 'YOUR_LIVE_SECRET_KEY'     # Replace with your live secret key
      base_url: 'https://api.alpaca.markets/v2'
    paper_1:
      enabled: true
      nickname: "Paper 1"
      api_key: 'YOUR_PAPER_API_KEY_1'        # Replace with your paper trading API key
      secret_key: 'YOUR_PAPER_SECRET_KEY_1'  # Replace with your paper trading secret key
      base_url: 'https://paper-api.alpaca.markets/v2'
    paper_2:
      enabled: true
      nickname: "Paper 2"
      api_key: 'YOUR_PAPER_API_KEY_2'        # Replace with your paper trading API key (optional)
      secret_key: 'YOUR_PAPER_SECRET_KEY_2'  # Replace with your paper trading secret key (optional)
      base_url: 'https://paper-api.alpaca.markets/v2'
    paper_3:
      enabled: true
      nickname: "Paper 3"
      api_key: 'YOUR_PAPER_API_KEY_3'        # Replace with your paper trading API key (optional)
      secret_key: 'YOUR_PAPER_SECRET_KEY_3'  # Replace with your paper trading secret key (optional)
      base_url: 'https://paper-api.alpaca.markets/v2'
  default_account: 'paper_1'                 # Specify which account to use by default
  active_account: 'paper_1'                  # Specify which account is currently active


  
####################################################################################################
# Data Paths (UNUSED)
####################################################################################################
paths:
  data_dir: 'data'                # Main data directory
  raw_data_dir: 'data/raw'        # Raw market data storage
  processed_data_dir: 'data/processed'  # Processed data storage
  log_dir: 'logs'                 # Directory for log files
  log_file: 'logs/app.log'        # Main application log file

####################################################################################################
# Strategy Settings
####################################################################################################
# ==========================================================================
# Multi-Strategy Orchestration
# ==========================================================================
# The orchestrator coordinates execution of multiple trading strategies.
# NOTE: Orchestration is now required as the legacy mode has been removed.
strategy_orchestration:
  # Possibly deprecated as there is no other ochestration mode at this time
  enabled: true                   # Master switch - REQUIRED enabled for system to run
  mode: "sequential"              # "sequential" | "parallel"
  max_parallel_workers: 3         # Max concurrent strategies when mode=parallel
  dry_run: false                  # Dry-run mode: evaluate plays, log actions, but skip actual orders
  # Useful for testing when market is closed or validating configurations

# ==========================================================================
# Capital Management
# ==========================================================================
# Controls position sizing and capital allocation across all strategies.
# RiskConfig in each playbook can tighten these limits on a per-playbook basis.
capital_management:
  enabled: true                          # Master switch; false = no capital checks performed
  max_total_open_positions: 10           # Max simultaneous open positions across all strategies (null = unlimited)
  max_capital_deployed_pct: 80.0         # Max % of account equity deployed at once (null = unlimited)
  per_symbol_max_open_positions: 2       # Default max open positions per ticker symbol
  buying_power_reserve_pct: 5.0          # Keep this % of buying power as a buffer

# ==========================================================================
# Individual Strategy Configurations
# ==========================================================================

options_swings:
  enabled: true
  entry_order_types:              # Types of orders to use
    - market
    - limit

  TP-SL_types:                    # Types of take-profit and stop-loss to use
    - STOCK_PRICE
    - PREMIUM_PCT
    - STOCK_PRICE_PCT
  
  Take_Profit:
    multiple_TPs: true
    TP_order_types:
      - market
      - limit

  SL_order_types:                 # Types of stop loss to use
    - STOP
    - LIMIT
    - CONTINGENCY

  conditional_plays:
    enabled: true
    reload_oco_peers: true

  play_types:                      # Types of plays to create
    - SIMPLE
#    - PRIMARY
#    - OCO
#    - OTO
  # Default values for live plays (NOT CURRENTLY IN USE. FOR FUTURE STREAMLINING/DEFAULTS)
  expiration_days: 14              # Default expiration in days for live plays
  entry_buffer: 0.05               # Entry price buffer for live plays (e.g., ±$0.01)
  take_profit_pct: 50.0            # Default take profit percentage
  stop_loss_pct: 25.5              # Default stop loss percentage

# Options Spreads
spreads:
  enabled: false
  spread_types:                    # Types of spreads to trade (future implementation)
    - vertical
    - iron_condor
    - butterfly

# Automated Options Swings (Auto-generated plays from scanner)
option_swings_auto:
  enabled: false
  auto_entry: true                 # Automatically enter positions
  auto_exit: true                  # Automatically exit positions
  risk_per_trade_pct: 2.0          # Max risk per trade as % of account
  max_concurrent_positions: 5      # Maximum open positions

# Momentum Strategy (Gap plays, squeeze fires, etc.)
momentum:
  enabled: false
  scan_interval: 60                # Seconds between scans
  indicators:
    ttm_squeeze: true
    ema_cross: true
  entry_signals:
    - squeeze_fire
    - ema_crossover

# Sell Puts Strategy (Cash-secured puts / TastyTrade style)
sell_puts:
  enabled: false
  target_delta: 0.3                 # Target delta for put selection
  dte_range:                        # Days to expiration range
    - 30
    - 45
  profit_target_pct: 50.0           # Close at 50% of max profit
  min_premium: 0.5                  # Minimum premium to collect

####################################################################################################
# Trading Parameters * NOT USED, CONSIDER REMOVING *
####################################################################################################
trading:
  default_symbol: 'SPY'              # Default trading symbol
  default_quantity: 1                # Default contract quantity

####################################################################################################
# Market Data Settings
####################################################################################################
market_data:
  interval: "1m"                     # Data granularity (1m = 1 minute)
  period: "1d"                       # Data fetch period (1d = 1 day)
  
  # Option chain display settings
  option_chain_display:
    default_columns:
      - strike
      - lastPrice
      - bid
      - ask
      - volume
      - impliedVolatility
    
    # Greeks display settings
    # By default only main 5 Greeks are displayed. Uncomment the ones you want to see.
    greeks:
      enabled: true
      columns:
        - delta
        - gamma
        - theta
        - vega
        - rho
#        - elasticity
#        - epsilon
#        - vanna
#        - charm
#        - vomma
#        - veta
#        - vera
#        - speed
#        - zomma
#        - color
#        - ultima
#        - parmicharma

####################################################################################################
# Technical Indicators settings *CURRENTLY AVAILABLE BUT NOT USED*
####################################################################################################
indicators:
  enabled: true
  ttm_squeeze:
    enabled: true
    period: 20
    bb_multiplier: 2.0
    kc_multiplier: 1.5
  ema:
    enabled: true
    periods: [9, 21, 55, 200]
  macd:
    enabled: true
    fast_period: 12
    slow_period: 26
    signal_period: 9
  columns:
    - squeeze_on
    - momentum
    - momentum_increasing
    - ema_above_below
    - ema_trends
    - macd_signals

####################################################################################################
# Strategy Settings
####################################################################################################
entry_strategy:
  buffer: 0.25                       # Price buffer for entry points (default is ±$0.05)

####################################################################################################
# Play Management (Position Management)
####################################################################################################
monitoring:
  max_retries: 3                     # Maximum retry attempts for operations
  retry_delay: 2                     # Delay between retries (seconds)
  polling_interval: 30               # Time between play / position checks (seconds); CYCLE TIME

####################################################################################################
# Trailing Stops Configuration (Feature Flags & Defaults)
####################################################################################################
trailing:
  enabled: false                     # Master switch for trailing features
  activation_threshold_pct: 50.0     # Absolute gain since entry to activate trailing (premium or stock)
  update_mode: "eod"                 # "eod" | "cycle"
  update_frequency_seconds: 30       # Used when update_mode = "cycle"

  tp1:
    basis: "profit_capture"          # "profit_capture" | "distance_from_current"
    start_capture_pct: 10.0          # If basis = profit_capture
    start_distance_below_pct: 30.0   # If basis = distance_from_current
    min_gap_below_current_pct: 20.0  # Enforced during ratcheting and updates
    ratcheting:
      enabled: true
      min_rise_since_last_pct: 30.0  # Rise since last ratchet to trigger
      ratchet_factor: 1.0            # Scaling of capture increase

  tp2:
    basis: "distance_from_current"   # Default ceiling method
    start_at_original_tp: true       # Start TP2 at original TP; then follow trailing ceiling
    distance_above_pct: 20.0         # Used if basis = distance_from_current
    capture_pct: 0.0                 # Used if basis = profit_capture

####################################################################################################
# Order Settings
####################################################################################################
orders:
  limit_buy:                         # THIS WAS AUTO GENERATED, NOT USED ATM.
    price_buffer: 0.25               # Buffer for limit order prices (NOT USED)
  bid_price_settings:                # AT THE BID PRICE SETTINGS
    use_bid_price: true              # Master switch for using bid prices
    entry: true                      # Use bid price for entry limit orders
    take_profit: true                # Use bid price for take profit limit orders
    stop_loss: true                  # Use bid price for stop loss limit orders
  limit_order:
    timeout_enabled: false           # Enable/disable limit order timeout checking
    max_duration_minutes: 5          # Maximum time to wait for limit order fill
    check_interval_seconds: 30       # How often to check order status

####################################################################################################
# File Operations
####################################################################################################
# Directories for play file management
file_paths:
  plays_dir: "plays"                      # Root directory for all play files
  new_dir: "new"                          # New plays which are yet to meet an entry condition
  pending_opening_dir: "pending-opening"  # Plays whose ENTRY condition has hit but limit order has not yet been filled
  open_dir: "open"                        # Currently active plays
  pending_closing_dir: "pending-closing"  # Plays whose EXIT condition has hit but limit order has not yet been filled
  closed_dir: "closed"                    # Closed plays whose position was closed
  expired_dir: "expired"                  # Expired plays (did not enter position by expiration date(s))
  temp_dir: "temp"                        # Temporary play storage for OTO conditional plays


####################################################################################################  
# Play Viewer Settings
####################################################################################################
# Choose which folders to display in the play viewer, and in what order.
viewer:
  enabled_folders:                      # Folders to display in the play viewer
    - new
    - pending-opening
    - open
    - pending-closing
    - closed
    - temp
    - expired
  folder_order:                         # Order to display the folders (top to bottom)
    - new
    - pending-opening
    - open
    - pending-closing
    - closed
    - temp
    - expired

####################################################################################################
# Logging Configuration
####################################################################################################
logging:
  level: "INFO"                      # Logging level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
  format: "%(asctime)s - %(levelname)s - %(message)s"  # Log message format
  file: "logs/app_run.log"           # Main application log file (overrides paths.log_file if set)
  rotation:
    type: "time"                     # "time" (TimedRotatingFileHandler) or "size" (RotatingFileHandler)
    when: "midnight"                 # For time-based rotation: 'S','M','H','D','midnight','W0'-'W6'
    interval: 30                     # Rotate every N intervals (e.g., ~monthly)
    backup_count: 14                 # How many rotated files to keep
    max_bytes: 10485760              # For size-based rotation: 10MB
    compress: true                   # Compress rotated logs
    compression_format: "gz"         # "gz" or "zip"

####################################################################################################
# Watchdog / Heartbeat System Settings (CURRENTLY DISABLED -- NEEDS WORK)
####################################################################################################
watchdog:
  enabled: false                    # Enable/disable the watchdog/heartbeat monitoring system
  check_interval: 30                # Interval in seconds between health checks
  warning: "EXPERIMENTAL: The watchdog system is experimental and may cause unexpected
    behavior."
  actions:
    log_warnings: true              # Log warning messages when issues are detected
    trigger_recovery: false         # Attempt to recover automatically when system appears unresponsive

####################################################################################################
# Startup Self-Tests Configuration
####################################################################################################
# Self-tests run at system startup to verify connectivity and configuration
startup_self_tests:
  enabled: true                       # Master switch for startup self-tests
  
  # Behavior on test failure
  on_primary_failure: "error"         # "error" = block trading start; "warn" = warn and continue
  on_fallback_failure: "warn"         # "error" or "warn" for non-primary market data providers
  on_brokerage_failure: "error"       # Brokerage (Alpaca) test failure behavior
  
  # Keep console window open on error to show user what happened
  pause_on_error: true                # If true, pause and wait for user input on critical errors
  
  # Individual test toggles (these are auto-enabled based on provider config if set to "auto")
  tests:
    alpaca_sdk:
      enabled: true                   # Test Alpaca SDK connectivity
    alpaca_api:
      enabled: true                   # Test Alpaca direct API connectivity
    marketdataapp:
      enabled: "auto"                 # "auto" = enabled if provider is enabled in config
    yfinance:
      enabled: "auto"                 # "auto" = enabled if provider is enabled in config
    alpaca_market_data:
      enabled: "auto"                 # "auto" = enabled if provider is enabled in config

####################################################################################################
# Market Hours Settings
####################################################################################################
market_hours:
  enabled: true                     # Enable/disable market hours validation
  timezone: "America/New_York"      # Market timezone
  regular_hours:
    start: "09:30"                  # Regular market open (HH:MM) -- start at market open
    # start: "09:29"                # Regular market open (HH:MM) -- start one minute early to account for cycle time
    end: "16:16"                    # Regular market close (HH:MM) -- note, some tickers e.g. SPY trade until 16:15
  extended_hours:
    enabled: false                  # Enable/disable extended hours trading
    pre_market_start: "04:00"       # Pre-market start (HH:MM)
    after_market_end: "20:00"       # After-market end (HH:MM)

####################################################################################################
# Auto Play Creator Settings
####################################################################################################
auto_play_creator:
  enabled: true                     # Enable/disable auto play creation
  order_types:                      # Types of orders to use
    - market
    - limit
  TP-SL_types:                      # Types of take profit and stop loss to use
    - STOCK_PRICE
    - PREMIUM_PCT
    - STOCK_PRICE_PCT
  
  stop_loss_types:                  # Types of stop loss to use
    - STOP
    - LIMIT
#    - CONTINGENCY

  play_types:                       # Types of plays to create
    - SIMPLE
#    - PRIMARY
#    - OCO
#    - OTO

  trade_types:                      # Types of trades to create
    - CALL
    - PUT
    - MIX
  expiration_days: 7                # Default expiration in days for test plays
  entry_buffer: 0.50                # Entry price buffer for test plays (fraction, e.g., 0.50 = ±50%)
  # Defaults for Option 1 (Pure Execution Testing)
  take_profit_pct: 1.5              # Default take profit percentage (pure execution)
  stop_loss_pct: 1.00               # Default stop loss percentage (pure execution)
  # Defaults for Option 2 (Simulate Real Plays)
  simulate_real:
    # Optional overrides used only in Simulate Real Plays mode
    take_profit_pct: 50.0
    stop_loss_pct: 30.0
    entry_buffer: 0.10              # Uncomment to override entry jitter for simulate_real
  # Defaults for Option 3 (OCO Peer Sets)
  oco_peer_set:
    # Optional overrides used only in OCO Peer Sets mode
    entry_buffer: 0.05              # Override entry jitter specifically for OCO (fraction, e.g., 0.01 = ±1%)
    take_profit_pct: 50.0           # Override TP percent specifically for OCO
    stop_loss_pct: 30.0             # Override SL percent specifically for OCO
  test_symbols:                     # Symbols to use for test plays
    - SPY
    - QQQ
    - AAPL
    - TSLA
    - NVDA
    - MSFT
    - GOOGL
    - AMZN
    - BABA
    - GME

####################################################################################################
# Chart Viewer Settings
####################################################################################################  
chart_viewer:
  indicators:
    enabled: true
    ema:
      enabled: true
      periods: [9, 21, 55, 200]
      colors: 
        - "#1f77b4"  # blue
        - "#ff7f0e"  # orange
        - "#2ca02c"  # green
        - "#d62728"  # red
    macd:
      enabled: true
      fast_period: 12
      slow_period: 26
      signal_period: 9
    rsi:
      enabled: false
      period: 14
    bollinger_bands:
      enabled: false
      period: 20
      std_dev: 2
    volume:
      enabled: true
      ma_period: 20
  display:
    style: "charles"  # Options: charles, classic, yahoo, etc.
    candle_up_color: "green"
    candle_down_color: "red"
    background_color: "white"
    grid: true
    grid_alpha: 0.2
    figure_size: [12, 8]  # [width, height] in inches

####################################################################################################
# Market Data Provider Settings
####################################################################################################
market_data_providers:
  # Primary provider will be used as the main source for data
  primary_provider: "marketdataapp"  # Options: "alpaca", "yfinance", "marketdataapp"
  
  # Enable/disable specific providers
  providers:
    marketdataapp:
      enabled: true
      cache:
        enabled: true
        max_age: 300  # 5 minutes
      api_key: "YOUR_MARKETDATAAPP_API_KEY"
      rate_limiting:
        enabled: true
        max_requests: 45  # Keep below 50 for safety
        window_seconds: 60
        
    yfinance:
      enabled: true
      cache:
        enabled: true
        max_age: 300
        
    alpaca:
      enabled: true
      use_websocket: true  # Enable real-time data streaming
      websocket_symbols:  # Symbols to stream real-time data for
        - "SPY"
        - "QQQ"
        - "AAPL"
      rate_limiting:
        enabled: true
        quotes_per_minute: 200  # Free tier limit
        buffer_percent: 10      # Stay 10% under limit to be safe
        retry_after: 5         # Seconds to wait when limit hit
      cache:
        enabled: true
        strategy: "lru"        # Options: lru, fifo, none
        max_size: 1000        # Maximum items in cache
        ttl:                  # Time-to-live in seconds
          quotes: 2           # Quote data expires quickly
          bars: 60           # Bar data can live longer
          trades: 5          # Trade data medium expiry
    
  
  # Data comparison settings
  comparison:
    enabled: true
    log_differences: true  # Log when providers give different values
    difference_threshold: 0.001  # Log if difference is greater than 0.1%
    metrics_to_compare:  # Which data points to compare between providers
      - "stock_price"
      - "option_chain"
      - "historical_data"
    
  # Historical data settings
  historical:
    default_interval: "1m"
    max_lookback_days: 7  # Maximum days of historical data to fetch
    
  # Real-time data settings
  realtime:
    update_interval: 5.0  # Seconds between real-time data updates
    max_symbols: 100    # Maximum number of symbols to track simultaneously

  fallback:
    enabled: true
    order: ["marketdataapp", "yfinance"]  # Provider priority order
    max_attempts: 2     # Maximum number of providers to try
    
  cache:
    enabled: true
    strategy: "cycle"
    cycle_based: true
    max_items: 10000    # Maximum items to store per cycle (prevent memory bloat)
    ttl:
      stock_price: 5    # Seconds
      option_quote: 5   # Seconds
      

####################################################################################################
# Watchlist Settings
####################################################################################################
# List of ticker symbols that tools (like auto_play_creator) can use
watchlist:
  - SPY
  - QQQ
  - AAPL
  - TSLA
  - NVDA
  - MSFT
  - GOOGL
  - AMZN
  - BABA
  - GME

####################################################################################################
# MULTI-MARKET DATA DISPLAY SETTINGS
####################################################################################################
market_data_display:
  option_chain:
    available_columns:      # All possible columns
      basic:
        - Provider
        - symbol
        - strike
        - expiration
        - type
        - bid
        - ask
        - last
        - volume
        - open_interest
        - implied_volatility
      greeks:
        - delta
        - gamma
        - theta
        - vega
        - rho
        - elasticity
        - epsilon
        - vanna
        - charm
        - vomma
        - veta
        - vera
        - speed
        - zomma
        - color
        - ultima
      
    enabled_columns:      # Currently displayed columns
      basic:             # Must match available_columns structure
        - Provider
        - symbol
#        - strike
#        - expiration
#        - type
        - bid
        - ask
        - last
        - volume
        - open_interest
        - implied_volatility
      greeks: []         # Empty list means no greek columns shown

    # Column formatting
    formatting:
      right_aligned:
        - strike
        - bid
        - ask
        - last
        - volume
        - open_interest
        - implied_volatility
        - delta
        - gamma
        - theta
        - vega
        - rho
      percentage_format:
        - implied_volatility
      price_format:
        - strike
        - bid
        - ask
        - last
      decimal_places:
        price: 2
        greeks: 4
        percentage: 2

####################################################################################################
# CSV Ingestor Settings -- not all settings are currently implemented
####################################################################################################
csv_ingestor:
  open_after_creation: false  # Whether to automatically open created JSON files
  default_viewer: "explorer"      # Options: "code" (VSCode), "explorer" (File Explorer), "none"
  validation:
    enabled: true             # Enable CSV validation before processing
    strictness_level: "moderate"  # "high" | "moderate" | "low" - controls how strictly validation results gate ingestion

    date_validation:
      min_days_warning: null  # Warn if expiration_date or play_expiration_date is less than N days out (null/off to disable)
      # Example: min_days_warning: 7  # Warn if dates are less than 7 days away

    earnings_validation:
      enabled: false          # Enable/disable upcoming earnings-based validation
      min_days_before_earnings: 7  # Require at least this many days between today and earnings; warn/error if fewer
      severity: "warning"     # "warning" to allow plays with a warning, "error" to block plays
      # NOTE: Earnings buffers are evaluated relative to UTC dates (UTC midnight as "today").
  backup:
    keep_originals: true      # Keep original CSV files after processing
    backup_dir: "ingestor_backups"  # Directory to store CSV backups

####################################################################################################
# Update Checker
####################################################################################################
update_check:
  # URL of the version.json manifest published by the release workflow.
  # Set this to your Nextcloud public share download URL once the n8n publishing
  # pipeline is configured.  Leave blank ("") to disable update checking.
  # Example: https://nextcloud.example.com/index.php/s/SHARETOKEN/download
  url: ""

  # Seconds to wait for the server before giving up.  Keep this low — a slow
  # or unreachable server should not delay the app startup experience.
  timeout_seconds: 5